"use strict";(self.webpackChunkfrontend_notes=self.webpackChunkfrontend_notes||[]).push([[142],{2326:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>a,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var t=r(4848),c=r(8453);const s={},d="useRef \u7684\u4f7f\u7528\u60c5\u5883",o={id:"react/useRef \u7684\u4f7f\u7528\u60c5\u5883",title:"useRef \u7684\u4f7f\u7528\u60c5\u5883",description:"useRef \u662f\u4ec0\u9ebc\uff1f",source:"@site/docs/react/useRef \u7684\u4f7f\u7528\u60c5\u5883.mdx",sourceDirName:"react",slug:"/react/useRef \u7684\u4f7f\u7528\u60c5\u5883",permalink:"/frontend-notes/docs/react/useRef \u7684\u4f7f\u7528\u60c5\u5883",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/react/useRef \u7684\u4f7f\u7528\u60c5\u5883.mdx",tags:[],version:"current",frontMatter:{},sidebar:"notesSidebar",previous:{title:"useCallback\u8207useMemo \u7684\u6b63\u78ba\u4f7f\u7528\u6642\u6a5f",permalink:"/frontend-notes/docs/react/react-zet-book/useCallback\u8207useMemo \u7684\u6b63\u78ba\u4f7f\u7528\u6642\u6a5f"},next:{title:"React Native",permalink:"/frontend-notes/docs/category/react-native"}},i={},l=[{value:"<code>useRef</code> \u662f\u4ec0\u9ebc\uff1f",id:"useref-\u662f\u4ec0\u9ebc",level:2},{value:"<code>useRef</code> \u7684\u4f7f\u7528\u60c5\u5883",id:"useref-\u7684\u4f7f\u7528\u60c5\u5883-1",level:2},{value:"1. \u5b58\u53d6 DOM \u5143\u7d20",id:"1-\u5b58\u53d6-dom-\u5143\u7d20",level:3},{value:"2.\u4fdd\u5b58\u8de8 re-render \u7684\u503c",id:"2\u4fdd\u5b58\u8de8-re-render-\u7684\u503c",level:3},{value:"\u5be6\u4f8b\u7df4\u7fd2",id:"\u5be6\u4f8b\u7df4\u7fd2",level:2},{value:"\u89e3\u984c",id:"\u89e3\u984c",level:2},{value:"\u521d\u59cb\u6e32\u67d3",id:"\u521d\u59cb\u6e32\u67d3",level:3},{value:"re-render",id:"re-render",level:3}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"useref-\u7684\u4f7f\u7528\u60c5\u5883",children:"useRef \u7684\u4f7f\u7528\u60c5\u5883"})}),"\n",(0,t.jsxs)(n.h2,{id:"useref-\u662f\u4ec0\u9ebc",children:[(0,t.jsx)(n.code,{children:"useRef"})," \u662f\u4ec0\u9ebc\uff1f"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"useRef"})," \u662f React \u63d0\u4f9b\u7684 hook\uff0c\u7528\u4f86\u5275\u5efa\u4e00\u500b \u53ef\u8b8a\uff08mutable\uff09\u7684\u5f15\u7528\u5c0d\u8c61\uff0c\u53ef\u4ee5\u7528\u4f86\u5b58\u53d6 DOM \u5143\u7d20\u6216\u4fdd\u5b58\u8de8\u8d8a\u591a\u6b21\u6e32\u67d3\u7684\u8cc7\u6599\uff0c\u4e14\u5728\u8cc7\u6599\u8b8a\u52d5\u6642\u4e0d\u6703\u89f8\u767c re-render\u3002"]}),"\n",(0,t.jsxs)(n.h2,{id:"useref-\u7684\u4f7f\u7528\u60c5\u5883-1",children:[(0,t.jsx)(n.code,{children:"useRef"})," \u7684\u4f7f\u7528\u60c5\u5883"]}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5b58\u53d6-dom-\u5143\u7d20",children:"1. \u5b58\u53d6 DOM \u5143\u7d20"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"useRef"})," \u6700\u5e38\u898b\u7684\u4f7f\u7528\u60c5\u5883\u4e4b\u4e00\u662f\u5b58\u53d6 DOM \u5143\u7d20\uff0c\u8b93\u6211\u5011\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c\u539f\u751f DOM\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:'live title="index.jsx"',live:!0,children:'function App() {\n  const inputRef = useRef(null);\n  return (\n    <div>\n      <label htmlFor="name">name:</label>\n      <input ref={inputRef} type="text" />\n      <div>\n        <button onClick={() => inputRef.current.focus()}>Click to Focus</button>\n      </div>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u9019\u500b\u4f8b\u5b50\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useRef"})," hook \u4f86\u5b58\u53d6 ",(0,t.jsx)(n.code,{children:"input"})," \u5143\u7d20\uff0c\u4e26\u4e14\u5728 ",(0,t.jsx)(n.code,{children:"button"})," \u7684 ",(0,t.jsx)(n.code,{children:"onClick"})," \u4e8b\u4ef6\u4e2d\uff0c\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"inputRef.current.focus()"})," \u4f86 focus \u5230 input \u5143\u7d20\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"2\u4fdd\u5b58\u8de8-re-render-\u7684\u503c",children:"2.\u4fdd\u5b58\u8de8 re-render \u7684\u503c"}),"\n",(0,t.jsxs)(n.p,{children:["\u9664\u4e86\u5b58\u53d6 DOM\uff0cu",(0,t.jsx)(n.code,{children:"useRef"})," \u4e5f\u53ef\u4ee5\u7528\u4f86\u4fdd\u5b58\u90a3\u4e9b\u4e0d\u6703\u56e0\u70ba component re-render \u800c\u5931\u53bb\u7684\u503c\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:'live title="index.jsx"',live:!0,children:"function Counter() {\n  const [count, setCount] = useState(0);\n  const renderCount = useRef(0);\n\n  renderCount.current += 1;\n\n  return (\n    <div>\n      <p>Count: {count}</p>\n      <p>Component rendered {renderCount.current} times</p>\n      <button onClick={() => setCount((prev) => prev + 1)}>Increment</button>\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u9019\u500b\u4f8b\u5b50\u4e2d\uff0crenderCount \u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useRef"})," \u4f86\u4fdd\u5b58 render \u7684\u6b21\u6578\uff0c\u9019\u6a23\u5c31\u4e0d\u6703\u56e0\u70ba ",(0,t.jsx)(n.code,{children:"count"})," \u7684\u6539\u8b8a\u800c\u91cd\u65b0 render\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["count \u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useState"})," \u4f86\u4fdd\u5b58\u7576\u524d\u8a08\u6578\u5668\u7684\u503c count\u3002\uff0c\u7576 ",(0,t.jsx)(n.code,{children:"count"})," \u6539\u8b8a\u6642\uff0c\u6703\u91cd\u65b0 render\uff0c\u4f46\u662f renderCount \u4e0d\u6703\u53d7\u5230\u5f71\u97ff\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u521d\u59cb\u6e32\u67d3\u6642\uff0c",(0,t.jsx)(n.code,{children:"renderCount.current"})," \u6703\u662f 1\uff0c\u7576 ",(0,t.jsx)(n.code,{children:"count"})," \u6539\u8b8a\u6642\uff0c",(0,t.jsx)(n.code,{children:"renderCount.current"})," \u6703\u6301\u7e8c\u589e\u52a0\u3002"]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["\u4fdd\u5b58\u524d\u4e00\u500b state \u7684\u503c\n",(0,t.jsx)(n.code,{children:"useRef"})," \u9084\u53ef\u4ee5\u7528\u4f86\u8ffd\u8e64 component \u5728\u524d\u4e00\u6b21 render \u4e2d\u7684 state \u503c\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:'live title="index.jsx"',live:!0,children:'function App() {\n  const [name, setName] = useState("Alice");\n  const prevName = useRef("");\n\n  useEffect(() => {\n    prevName.current = name;\n  }, [name]);\n\n  return (\n    <div>\n      <p>Current name: {name}</p>\n      <p>Previous name: {prevName.current}</p>\n      <button onClick={() => setName("Bob")}>Change Name</button>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u9019\u500b\u4f8b\u5b50\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useRef"})," \u4f86\u4fdd\u5b58\u524d\u4e00\u500b ",(0,t.jsx)(n.code,{children:"name"})," \u7684\u503c\u3002\u6bcf\u6b21 ",(0,t.jsx)(n.code,{children:"name"})," \u6539\u8b8a\u6642\uff0c",(0,t.jsx)(n.code,{children:"prevName.current"})," \u90fd\u6703\u66f4\u65b0\u70ba\u4e0a\u4e00\u6b21\u7684 ",(0,t.jsx)(n.code,{children:"name"}),"\u3002"]}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"\u8ffd\u8e64\u67d0\u500b effect \u526f\u4f5c\u7528\u662f\u5426\u5df2\u7d93\u57f7\u884c\u904e\n\u5728\u67d0\u4e9b\u60c5\u6cc1\u4e0b\uff0c\u6211\u5011\u9700\u8981\u907f\u514d\u526f\u4f5c\u7528\u591a\u6b21\u57f7\u884c\uff0c\u9019\u6642\u53ef\u4ee5\u4f7f\u7528 useRef \u4f86\u8ffd\u8e64\u662f\u5426\u5df2\u7d93\u57f7\u884c\u904e\u67d0\u500b\u64cd\u4f5c\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:'live title="index.jsx"',live:!0,children:'function App() {\n  const hasFetched = useRef(false);\n\n  useEffect(() => {\n    if (!hasFetched.current) {\n      console.log("Fetching data...");\n      hasFetched.current = true;\n    }\n  }, []);\n\n  return <div>Data has been fetched</div>;\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u9019\u500b\u4f8b\u5b50\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"hasFetched"})," \u4f86\u8ffd\u8e64\u662f\u5426\u5df2\u7d93\u57f7\u884c\u904e fetch data \u7684\u64cd\u4f5c\u3002\u7576 ",(0,t.jsx)(n.code,{children:"hasFetched.current"})," \u70ba ",(0,t.jsx)(n.code,{children:"false"})," \u6642\uff0c\u6703\u57f7\u884c ",(0,t.jsx)(n.code,{children:'console.log("Fetching data...")'}),"\uff0c\u4e26\u5c07 ",(0,t.jsx)(n.code,{children:"hasFetched.current"})," \u8a2d\u70ba ",(0,t.jsx)(n.code,{children:"true"}),"\uff0c\u9019\u6a23\u5c31\u53ef\u4ee5\u907f\u514d\u91cd\u8907\u57f7\u884c fetch data \u7684\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u5be6\u4f8b\u7df4\u7fd2",children:"\u5be6\u4f8b\u7df4\u7fd2"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://bigfrontend.dev/react-quiz/useRef",children:"13. useRef"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'// This is a React Quiz from BFE.dev\n\nimport * as React from "react";\nimport { useRef, useEffect, useState } from "react";\nimport { createRoot } from "react-dom/client";\n\nfunction App() {\n  const ref = useRef(null);\n  const [state, setState] = useState(1);\n\n  useEffect(() => {\n    setState(2);\n  }, []);\n\n  console.log(ref.current?.textContent);\n\n  return (\n    <div>\n      <div ref={state === 1 ? ref : null}>1</div>\n      <div ref={state === 2 ? ref : null}>2</div>\n    </div>\n  );\n}\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u89e3\u984c",children:"\u89e3\u984c"}),"\n",(0,t.jsx)(n.h3,{id:"\u521d\u59cb\u6e32\u67d3",children:"\u521d\u59cb\u6e32\u67d3"}),"\n",(0,t.jsx)(n.p,{children:"\u5728\u521d\u59cb\u6e32\u67d3\uff0creact \u547c\u53eb App component function \u7522\u751f react element \uff0c\u4e26\u4e14\u8f49\u63db\u76f8\u5c0d\u61c9\u7684 DOM \u639b\u8f09\u5230\u87a2\u5e55\u4e0a\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["\u57f7\u884c ",(0,t.jsx)(n.code,{children:"console.log(ref.current?.textContent)"}),"\uff0c\u56e0\u70ba useRef \u7684\u521d\u59cb\u503c\u662f ",(0,t.jsx)(n.code,{children:"null"})," \u6240\u4ee5\u5370\u51fa ",(0,t.jsx)(n.code,{children:"undefined"}),"\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"state"})," \u70ba 1\uff0c\u56e0\u6b64\u7b2c\u4e00\u500b div \u5143\u7d20\u88ab\u5f15\u7528\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u63a5\u8457\uff0creact \u57f7\u884c ",(0,t.jsx)(n.code,{children:"useEffect"})," \u4e2d ",(0,t.jsx)(n.code,{children:"setState(2)"})," \u6703\u89f8\u767c re-render\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"re-render",children:"re-render"}),"\n",(0,t.jsx)(n.p,{children:"\u91cd\u65b0\u547c\u53eb App component function \u7522\u751f react element \u7d93\u904e diff \u6bd4\u8f03\u5f8c\u66f4\u65b0 DOM\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["\u57f7\u884c ",(0,t.jsx)(n.code,{children:"console.log(ref.current?.textContent)"}),"\uff0c\u56e0\u70ba ",(0,t.jsx)(n.code,{children:"useRef"}),' \u4fdd\u5b58\u4e86\u4e0a\u4e00\u6b21\u7684\u503c\uff0c\u6240\u4ee5\u5370\u51fa\n"1"\u3002']}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 re-render \u6642\uff0c\u56e0\u70ba ",(0,t.jsx)(n.code,{children:"state"})," \u66f4\u65b0\u70ba 2\uff0c\u7b2c\u4e00\u500b div \u5143\u7d20\u7684 ",(0,t.jsx)(n.code,{children:"ref"})," \u88ab\u8a2d\u70ba ",(0,t.jsx)(n.code,{children:"null"}),"\uff0c\u7b2c\u4e8c\u500b div \u5143\u7d20\u88ab\u5f15\u7528\u3002"]})]})}function a(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>o});var t=r(6540);const c={},s=t.createContext(c);function d(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);