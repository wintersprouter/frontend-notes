"use strict";(self.webpackChunkfrontend_notes=self.webpackChunkfrontend_notes||[]).push([[7343],{2744:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=t(4848),a=t(8453);const r={},i="\u8acb\u8aaa\u660e JavaScript \u4e2d\u7684\u4e8b\u4ef6\u59d4\u6d3e event delegation \u662f\u4ec0\u9ebc?",l={id:"Javascript/event_delegation",title:"\u8acb\u8aaa\u660e JavaScript \u4e2d\u7684\u4e8b\u4ef6\u59d4\u6d3e event delegation \u662f\u4ec0\u9ebc?",description:"\u4e8b\u4ef6\u59d4\u6d3e event delegation",source:"@site/docs/Javascript/05-event_delegation.md",sourceDirName:"Javascript",slug:"/Javascript/event_delegation",permalink:"/frontend-notes/docs/Javascript/event_delegation",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Javascript/05-event_delegation.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"notesSidebar",previous:{title:"\u8acb\u8aaa\u660e JavaScript \u4e2d\u7684\u4e8b\u4ef6\u5faa\u74b0 event loop \u662f\u4ec0\u9ebc?",permalink:"/frontend-notes/docs/Javascript/event_loop"},next:{title:"\u8acb\u8aaa\u660e this \u5982\u4f55\u5728 JavaScript \u4e2d\u904b\u4f5c\uff1f",permalink:"/frontend-notes/docs/Javascript/this"}},d={},s=[{value:"\u4e8b\u4ef6\u59d4\u6d3e event delegation",id:"\u4e8b\u4ef6\u59d4\u6d3e-event-delegation",level:2},{value:"\u5be6\u4f8b\u7df4\u7fd2",id:"\u5be6\u4f8b\u7df4\u7fd2",level:2},{value:"\u89e3\u984c",id:"\u89e3\u984c",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u8acb\u8aaa\u660e-javascript-\u4e2d\u7684\u4e8b\u4ef6\u59d4\u6d3e-event-delegation-\u662f\u4ec0\u9ebc",children:"\u8acb\u8aaa\u660e JavaScript \u4e2d\u7684\u4e8b\u4ef6\u59d4\u6d3e event delegation \u662f\u4ec0\u9ebc?"})}),"\n",(0,o.jsx)(n.h2,{id:"\u4e8b\u4ef6\u59d4\u6d3e-event-delegation",children:"\u4e8b\u4ef6\u59d4\u6d3e event delegation"}),"\n",(0,o.jsx)(n.p,{children:"\u4e8b\u4ef6\u59d4\u6d3e event delegation \u662f\u4e00\u7a2e JavaScript Pattern\uff0c\u5728\u7236\u5c64 DOM \u5143\u7d20\u4e0a\u53ea\u8981\u7d81\u5b9a\u4e00\u500b\u76e3\u807d\u5668\uff0c\u5e95\u4e0b\u7684\u5b50\u5143\u7d20\u5c31\u770b\u900f\u904e**\u4e8b\u4ef6\u5192\u6ce1\uff08Event Bubbling\uff09**\u6a5f\u5236\u89f8\u767c\u7236\u5c64\u7684\u76e3\u807d\u5668\uff0c\u5982\u6b64\u4e00\u4f86\u5c31\u4e0d\u9700\u8981\u5728\u6bcf\u4e00\u500b\u5b50\u5143\u7d20\u4e0a\u7d81\u5b9a\u500b\u76e3\u807d\u5668\uff0c\u53ea\u8981\u5728\u5176\u5171\u540c\u7684\u7236\u5143\u7d20\u4e0a\u7d81\u5b9a\u4e00\u500b\u5373\u53ef\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u512a\u9ede:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u7bc0\u7701\u8a18\u61b6\u9ad4\uff1a\u76e3\u807d\u5668\u6578\u91cf\u8b8a\u5c11\uff0c\u4e5f\u5c31\u53ef\u4ee5\u63d0\u5347\u6548\u80fd\u3002"}),"\n",(0,o.jsx)(n.li,{children:"\u63d0\u9ad8\u7a0b\u5f0f\u78bc\u7dad\u8b77\u6027\uff1a\u8655\u7406\u4e8b\u4ef6\u7684\u908f\u8f2f\u53ea\u9700\u8981\u5728\u7236\u5143\u7d20\u7684\u76e3\u807d\u5668\u5beb\u4e00\u6b21\u3002"}),"\n",(0,o.jsx)(n.li,{children:"\u53ef\u4ee5\u652f\u63f4\u52d5\u614b\u5143\u7d20\uff1a\u53ef\u4ee5\u52d5\u614b\u7684\u8abf\u6574\u589e\u52a0\u5b50\u5143\u7d20\uff0c\u4e0d\u9700\u8981\u984d\u5916\u7684\u529b\u6c23\u8655\u7406\u7d81\u5b9a\u6216\u79fb\u9664\u5b50\u5143\u7d20\u4e0a\u7684\u76e3\u807d\u5668\u3002"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<ul id="devices">\n  <li>iPhone 16</li>\n  <li>S24 Ultra</li>\n  <li>Pixel 9 Pro XL</li>\n</ul>\n\n<script>\n  const devices = document.getElementById("devices");\n\n  devices.addEventListener("click", function (event) {\n    if (event.target.tagName === "LI") {\n      console.log(event.target.innerText);\n    }\n  });\n<\/script>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u9019\u500b\u4f8b\u5b50\u4e2d\uff0c",(0,o.jsx)(n.code,{children:"devices"}),"\u4f5c\u70ba\u7236\u5143\u7d20\u88ab\u7d81\u5b9a\u76e3\u807d\u5668\uff0c\u5c07\u7576\u9ede\u64ca",(0,o.jsx)(n.code,{children:"<li>"}),"\uff0c",(0,o.jsx)(n.code,{children:"<li>"}),"\u5c31\u900f\u904e\u4e8b\u4ef6\u5192\u6ce1\u5411\u4e0a\u50b3\u905e\u5230",(0,o.jsx)(n.code,{children:"devices"}),"\uff0c\u63a5\u8457\u5c31\u53ef\u4ee5\u900f\u904e",(0,o.jsx)(n.code,{children:"event.target"}),"\u4f86\u6aa2\u67e5\u5be6\u969b\u89f8\u767c\u4e8b\u4ef6\u7684\u5b50\u5143\u7d20\u662f\u5426\u7b26\u5408\u689d\u4ef6\uff0c\u9032\u800c\u57f7\u884c\u8655\u7406\u4e8b\u4ef6\u7684\u908f\u8f2f"]}),"\n",(0,o.jsx)(n.h2,{id:"\u5be6\u4f8b\u7df4\u7fd2",children:"\u5be6\u4f8b\u7df4\u7fd2"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://bigfrontend.dev/problem/event-delegation",children:"117. event delegation"})}),"\n",(0,o.jsx)(n.p,{children:"Can you create a function which works like jQuery.on(), that attaches event listeners to selected elements."}),"\n",(0,o.jsx)(n.p,{children:"In jQuery, selector is used to target the elements, in this problem, it is changed to a predicate function."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'onClick(\n  // root element\n  document.body,\n  // predicate\n  (el) => el.tagName.toLowerCase() === "div",\n  function (e) {\n    console.log(this);\n    // this logs all the `div` element\n  },\n);\n'})}),"\n",(0,o.jsx)(n.p,{children:"event.stopPropagation() and event.stopImmediatePropagation() should also be supported."}),"\n",(0,o.jsx)(n.p,{children:"you should only attach one real event listener to the root element."}),"\n",(0,o.jsx)(n.h2,{id:"\u89e3\u984c",children:"\u89e3\u984c"}),"\n",(0,o.jsx)(n.p,{children:"\u9019\u984c\u592a\u96e3\u4e86\uff0c\u6240\u4ee5\u6211\u770b\u4e86\u5225\u4eba\u7684\u89e3\u7b54\u8a66\u5716\u53bb\u7406\u89e3\u3002"}),"\n",(0,o.jsxs)(n.p,{children:["\u53c3\u8003\u89e3\u7b54\uff1a",(0,o.jsx)(n.a,{href:"https://www.youtube.com/watch?v=TkBQYTi1jJU%3E",children:"BFE.dev 117. event delegation | JSer - Front-End Interview questions"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'// Map<node, Array<[predicate, handler]>>\nconst allHandlers = new Map(); //\u7528\u4f86\u5132\u5b58\u6bcf\u500b root \u5143\u7d20\u53ca\u5176\u5c0d\u61c9\u7684\u4e8b\u4ef6\u8655\u7406\u5668\u3002\u6bcf\u500b root \u90fd\u6703\u5c0d\u61c9\u4e00\u500b Array\uff0c\u5176\u4e2d\u5b58\u653e\u4e86\u591a\u7d44 [predicate, handler]\n/**\n * @param {HTMLElement} root \u6839\u5143\u7d20\uff0c\u4e8b\u4ef6\u76e3\u807d\u5668\u5c07\u7d81\u5b9a\u5728\u9019\u500b\u5143\u7d20\u4e0a\n * @param {(el: HTMLElement) => boolean} predicate \u5224\u65b7\u51fd\u6578\uff0c\u7528\u65bc\u6aa2\u67e5\u4e8b\u4ef6\u76ee\u6a19\u662f\u5426\u7b26\u5408\u689d\u4ef6\n * @param {(e: Event) => void} handler \u4e8b\u4ef6\u8655\u7406\u51fd\u6578\uff0c\u7576\u4e8b\u4ef6\u76ee\u6a19\u7b26\u5408\u689d\u4ef6\u6642\u547c\u53eb\n */\nfunction onClick(root, predicate, handler) {\n  if (allHandlers.has(root)) {\n    //\u6aa2\u67e5 allHandlers \u662f\u5426\u5df2\u7d93\u5132\u5b58\u4e86\u5c0d\u61c9\u7684 root \u5143\u7d20\u3002\u5982\u679c\u5df2\u7d93\u6709\uff0c\u5247\u76f4\u63a5\u5c07\u65b0\u7684 [predicate, handler] \u5c0d\u6dfb\u52a0\u5230\u8a72 root \u5143\u7d20\u7684\u8655\u7406\u5668\u5217\u8868\u4e2d\n    allHandlers.get(root).push([predicate, handler]);\n    //\u5c07\u65b0\u7684 [predicate, handler] \u5c0d\u6dfb\u52a0\u5230\u8a72 root \u5143\u7d20\u7684\u8655\u7406\u5668\u5217\u8868\u4e2d\n    return;\n  }\n  //\u5982\u679c\u6c92\u6709\u5c0d\u61c9\u7684 root \u5143\u7d20\uff0c\u5247\u5275\u5efa\u4e00\u500b\u65b0\u7684\u6578\u7d44\n  allHandlers.set(root, [[predicate, handler]]);\n  // \u7136\u5f8c\u5728 root \u4e0a\u7d81\u5b9a\u4e00\u500b click \u4e8b\u4ef6\u76e3\u807d\u5668\n  root.addEventListener(\n    "click",\n    function (e) {\n      // \u5f9e\u4e8b\u4ef6\u76ee\u6a19\u5143\u7d20 e.target \u958b\u59cb\uff0c\u4e00\u5c64\u5c64\u5411\u4e0a\u904d\u6b77 DOM \u7d50\u69cb\uff0c\u76f4\u5230\u5230\u9054 root \u5143\u7d20\u6216\u4e8b\u4ef6\u5192\u6ce1\u88ab\u505c\u6b62\n      let el = e.target;\n      const handlers = allHandlers.get(root);\n      let isPropagationStopped = false;\n      e.stopPropagation = () => {\n        //\u7528\u4f86\u624b\u52d5\u63a7\u5236\u4e8b\u4ef6\u50b3\u64ad\uff0c\u907f\u514d\u4e8b\u4ef6\u7e7c\u7e8c\u5192\u6ce1\u5230\u7236\u5143\u7d20\n        isPropagationStopped = true;\n      };\n      //\u4f7f\u7528 while (el) \u6aa2\u67e5\u4e8b\u4ef6\u76ee\u6a19\u53ca\u5176\u7236\u5143\u7d20\u662f\u5426\u7b26\u5408\u5224\u65b7\u51fd\u6578\u7684\u689d\u4ef6\n      while (el) {\n        let isImmediatePropagationStopped = false;\n        e.stopImmediatePropagation = () => {\n          //isImmediatePropagationStopped \u505c\u6b62\u50b3\u64ad\u4e8b\u4ef6\u7684\u540c\u6642\u4e5f\u505c\u6b62\u540c\u4e00\u5143\u7d20\u4e0a\u5f8c\u7e8c\u7684\u8655\u7406\u5668\u57f7\u884c\n          isImmediatePropagationStopped = true;\n          isPropagationStopped = true;\n        };\n        for (const [predicate, handler] of handlers) {\n          //predicate(el)\uff1a\u7528\u4f86\u5224\u65b7\u7576\u524d\u5143\u7d20\u662f\u5426\u7b26\u5408\u689d\u4ef6\n          if (predicate(el)) {\n            //\u57f7\u884c\u5c0d\u61c9\u7684 handler \u8655\u7406\u51fd\u5f0f\n            handler.call(el, e);\n            // \u6aa2\u67e5\u662f\u5426\u9700\u8981\u505c\u6b62\u4e8b\u4ef6\u50b3\u64ad\n            if (isImmediatePropagationStopped) {\n              break;\n            }\n          }\n        }\n        //\u5982\u679c isPropagationStopped \u8a2d\u70ba true\uff0c\u6216\u8005\u5df2\u7d93\u904d\u6b77\u5230 root \u5143\u7d20\uff0c\u5247\u505c\u6b62\u4e8b\u4ef6\u7684\u7e7c\u7e8c\u50b3\u64ad\n        if (el === root || isPropagationStopped) break;\n        el = el.parentElement;\n      }\n    },\n    false,\n  );\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var o=t(6540);const a={},r=o.createContext(a);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);